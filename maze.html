<html>
<head>
  <title>ESCAPE FROM MAZE 13</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
	<link rel="stylesheet" type="text/css" href="main.css" />
</head>
<body onresize="resizeCanvas()">
<div class="ol"></div> 

<header><h1><div class="sm">ESCAPE FROM</div>MAZE 13</h1></header>
<main>
 
<div id="start" >
 <p>Things are not stable, glitches in time are warping the mazes</p>
 <p>Click, tap or use arrow keys to run, find the exit and survive</p>
 <p>No matter what you must escape<span class="ln">|</span></p>
 <button class="btn go">Enter The Maze</button>
</div>

<div id="end" class="hdn">
  <p>A true survivor you made it in..</p>
  <p id="tm" class="lg"></p>
  <a href="" id="tw" target="_blank" class="btn">Share Your Time</a>
  <button class="btn go" >Beat Your Time</button>
</div>

<div id="starting" class="hdn">
  <p><p>
</div>

<div id="mz" class="hdn">
  <canvas id="canvas"></canvas>
</div>

</main>

<footer class="hdn">
  <div class="doc">
  <span id="min">0</span>m
  <span id="sec">0</span>s 
  <span id="ms">0</span>ms
</div>
</footer>

<button id="mte" class="hdn">Mute</button>

<script  type="text/javascript" language="javascript" src="utils.js"></script>
<script  type="text/javascript" language="javascript" src="player.js"></script>
<script  type="text/javascript" language="javascript" src="glitch.js"></script>
<script  type="text/javascript" language="javascript" src="maze.js"></script>
<script  type="text/javascript" language="javascript" src="game.js"></script>
<script  type="text/javascript" language="javascript">
 
const context = document.getElementById("canvas").getContext("2d");
const g = new Game(context,
  (e)=>{
      if(e==gs.play){
        $("footer")[0].classList.remove("hdn");
        $("#starting")[0].classList.add("hdn");
        $("#mz")[0].classList.remove("hdn");
        resizeCanvas()
      }
      if(e==gs.pause){$("#pause")[0].classList.remove("hdn")}
      if(e==gs.win){
        $("#end")[0].classList.remove("hdn");
        $("#tw")[0].href = "https://twitter.com/intent/tweet?text=I%20have%20just%20escaped%20maze%2013%20in%20" + encodeURIComponent($("#tm")[0].innerText) + "%20at%20" + encodeURIComponent(this.window.location.href) + "&hashtags=js13k,maze13&via=johnkilmister";
      }
    },
  (s,m,ms)=>
      {
          $("#sec")[0].innerText = s;
          $("#min")[0].innerText  = m; 
          $("#ms")[0].innerText  = ms; 
          $("#tm")[0].innerText = `${m}m ${s}s ${ms}ms`; 
      });
 
$(".go").on("click", ()=>{
  $("#starting")[0].classList.remove("hdn");
  $("#start")[0].classList.add("hdn"); 
  $("#end")[0].classList.add("hdn");
  var e = $("#starting p")[0];
  e.classList.add("cd");
  e.innerText = 3;
  e.on("animationstart", e => {e.target.innerHTML=3});
  e.on("animationiteration", e => {e.target.innerHTML=3-Math.abs(e.elapsedTime)});
  e.on("animationend", e => {g.start()});
});
$("#mte")[0].on("click", ()=>{g.mute()});
$(".tri").on("mousedown", (e)=>{e.preventDefault();g.keys[parseInt(e.target.dataset.key)]=true});
$(".tri").on("mouseup", (e)=>{e.preventDefault();g.keys[parseInt(e.target.dataset.key)]=false});
 $("#canvas").on("click", (e)=>{g.aim(e.clientX,e.clientY)});
document.onkeydown = (e) =>{g.keys[e.keyCode]=true;}
document.onkeyup = (e) =>{g.keys[e.keyCode]=null;}

(function () {
  function main(tFrame) {
    g.stopMain = window.requestAnimationFrame(main);
    
    g.update(tFrame);  
    g.render();
  }
  
  main(); 
})();

function resizeCanvas(){
    let c = $("#canvas")[0];
    let m = $("main")[0];
    c.width  = m.offsetWidth-30;
    c.height  = m.offsetHeight-30;   
}

	</script>	
 
	</body>
</html>